<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
      layout:decorate="~{/template/common/layout/defaultLayout.html}"
      layout:fragment="content">
<head>
  <link rel="stylesheet" th:href="@{/css/index.css}"/>
  <title>Document</title>
</head>
<body>
      <div class="parent">
        <div class="box info">info
          <a href="/base/updatePage">동물업데이트</a>
          <div id="info_box">

          </div>
        </div>
        <div class="box animal0" id="main_box0">
          <div class="box animal_pic">
            <a id="a_main0"><img id="main_pic0" class="main_con_img"></a>
          </div>
          <div class="box animal_con" id="main_con0">
            <div class="title_div" id="main_con_title0"></div>
            <div class="content_div" id="main_con_content0"></div>
          </div>
        </div>
        <div class="box animal1">
          <div class="box animal_pic">
            <a id="a_main1"><img id="main_pic1" class="main_con_img"></a>
          </div>
          <div class="box animal_con" id="main_con1">
            <div class="title_div" id="main_con_title1"></div>
            <div class="content_div" id="main_con_content1"></div>
          </div>
        </div>
        <div class="box animal2">
          <div class="box animal_pic">
            <a id="a_main2"><img id="main_pic2" class="main_con_img"></a>
          </div>
          <div class="box animal_con" id="main_con2">
            <div class="title_div" id="main_con_title2"></div>
            <div class="content_div" id="main_con_content2"></div>
          </div>
        </div>
        <div class="box animal3">
          <div class="box animal_pic">
            <a id="a_main3"><img id="main_pic3" class="main_con_img"></a>
          </div>
          <div class="box animal_con" id="main_con3">
            <div class="title_div" id="main_con_title3"></div>
            <div class="content_div" id="main_con_content3"></div>
          </div>
        </div>
        <!-- 사이드 -->
        <div class="box rList0 side_wrap">
          <div class="side_img_wrap"> <a id="a_img0"><img id="img0"></a> </div>
          <div class="side_con_wrap">
            <div>
              <ul class="side" id="side0"></ul>
            </div>
          </div>
        </div>
        <div class="box rList1 side_wrap">
          <div class="side_img_wrap"><a id="a_img1"><img id="img1"></a></div>
          <div class="side_con_wrap">
            <div>
              <ul class="side" id="side1"></ul>
            </div>
          </div>
        </div>
        <div class="box rList2 side_wrap">
          <div class="side_img_wrap"><a id="a_img2"><img id="img2"></a></div>
          <div class="side_con_wrap">
            <div>
              <ul class="side" id="side2"></ul>
            </div>
          </div>
        </div>
</div>
</body>
<script th:inline="javascript">
  let data=null;
  let bookmark=null;
          async function getAsideList() {
    try{
      const response = await fetch('/animalBoard/getAsideBoard', {
        headers: {
          'Content-Type': 'application/json'
        },
      })
       data = await response.json();
      for(i=0; i<= data.length; i++){
         let side = document.getElementById(`side${i}`);
         let li0 = document.createElement('li');
         let li1 = document.createElement('li');
         let li2 = document.createElement('li');
         let img= document.getElementById(`img${i}`)
         let a = document.getElementById(`a_img${i}`);
         li0.innerHTML = `<li> 지역 : ${data[i].sigun_NM} </li>`;
         li1.innerHTML = `<li> 공고종료일 : ${data[i].pblanc_END_DE} </li>`;
         li2.innerHTML = `<li> 종별 : ${data[i].species_NM}</li>`;
         img.setAttribute('src', data[i].image_COURS);
         img.setAttribute('width', '180px');
         side.appendChild(li0);
         side.appendChild(li1);
         side.appendChild(li2);
         a.setAttribute('href', '/animalBoard/animalBoard?ASEQ='+data[i].aseq);
      }
    }catch(error){
      console.error(error);
    }
  }

  async function getBookmarkList() {

    try {
      const response = await fetch('/adoptBoard/bookmarkList', {
        headers: {
          'Content-Type': 'application/json',
        },
          'method' : 'POST',
      })
        if(response.ok){
          bookmark = await response.json();

          for(i=0; i<bookmark.thumbnailList.length;i++){
            let main_pic_div =  document.getElementById(`main_pic${i}`);
            let main_con_title = document.getElementById(`main_con_title${i}`);
            let main_con_content = document.getElementById(`main_con_content${i}`)
            let title_p = document.createElement('p');
            let content_p = document.createElement('p');
            let adt_id = bookmark.thumbnailList[i]?.adt_id ?? 'x'; //애초에 thumnailList[0]이 null이기 때문에 그부분에 ?.를 넣어줬어야했음
            if(adt_id!=='x'){
              document.getElementById(`a_main${i}`).href=`/adoptBoard/${bookmark.thumbnailList[i].adt_id}`;
              main_pic_div.src= `/adoptBoard/images/${bookmark.thumbnailList[i].store_file_name}`;
              title_p.innerText = bookmark.boardList[i].title;
              content_p.innerText = bookmark.boardList[i].content;
              main_con_title.appendChild(title_p);
              main_con_content.appendChild(content_p);
            }else{
              console.log(`북마크된 게시글 x`);
            }


            console.log(main_con_title);

          }
        }

    }catch(error){
      console.error(error);
    }
  }

  window.addEventListener('DOMContentLoaded', ()=>{
    getAsideList();
    getBookmarkList();
  });
</script>
</html>