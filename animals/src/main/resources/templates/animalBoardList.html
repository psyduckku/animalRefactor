<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:layout="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="/css/header.css" th:href="@{/css/header.css}"/>
    <link rel="stylesheet" href="/css/animalList.css" th:href="@{/css/animalList.css}"/>
    <link rel="stylesheet" href="/css/footer.css" th:href="@{/css/footer.css}">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.2.2/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-Zenh87qX5JnK2Jl0vWa8Ck2rdkQ2Bzep5IDxbcnCeuOxjzrPF/et3URy9Bv1WTRi" crossorigin="anonymous">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta charset="UTF-8">
    <title>Title</title>
    <style>
        /*#list_img img{*/
        /*    width: 250px;*/
        /*    height: 250px;*/
        /*}*/
    </style>
</head>
<body>
<div th:include="~{/template/fragment/header :: copy}"></div>
<h1 style="text-align: center">유기동물명단</h1>
<div class="table_container">
    <div class="subnav">
        <form action="/animalBoard/animalBoardList" method="get">
            <label>
                <select th:name="sortRegion">
                    <option th:each=" region : ${sortRegion}"
                            th:value="${region.value}" th:text="${region.key}">
                        지역분류
                    </option>
                </select>
            </label>
            <label>
                <select th:name="sortSpecies">
                    <option th:each="species : ${sortSpecies}"
                            th:value="${species.value}" th:text="${species.key}">
                        종분류
                    </option>
                </select>
            </label>
            <input type="submit" value=" 검 색 " class="search">
        </form>
    </div>
<div class="table-responsive">
    <table class="table table-hover">
        <tr class="table-info">
            <td>이미지</td>
            <td id="sigun">시군</td>
            <td id="dscvr">발견장소</td>
            <td id="recept">접수일자</td>
            <td id="species">품종</td>
            <td id="state">상태</td>
            <td id="crct">특징</td>
        </tr>
        <th:block>
            <tr th:each="info : ${response.list}">
                <td id="list_img"><a th:href="@{/animalBoard/getAnimalBoard(ASEQ=${info.ASEQ})}"><img th:src="${info.IMAGE_COURS}" class="img" alt="#"></a></td>
                <td class="table-default" th:text="${info.SIGUN_NM}">시군</td>
                <td class="table-default" th:text="${info.DISCVRY_PLC_INFO}">발견장소</td>
                <td class="table-default" th:text="${info.RECEPT_DE}">접수일자</td>
                <td class="table-default" th:text="${info.SPECIES_NM}">품종</td>
                <td class="table-default" th:text="${info.STATE_NM}">상태</td>
                <td class="table-default info" th:text="${info.SFETR_INFO}">특징</td>
            </tr>
        </th:block>
</table>
    </div>
</div>
<!-- pagination rendering area-->
<nav aria-label="Page navigation example">
<div class="paging"></div>
</nav>
<!-- button -->

</body>
<script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js" integrity="sha384-oBqDVmMz9ATKxIep9tiCxS/Z9fNfEXiDAYTujMAeBAsjFuCZSmKbSSUnQlmh/jp3" crossorigin="anonymous"></script>
<th:block layout:fragment="boardScript">
    <script th:inline="javascript">

        /***
         * 게시글 numbering 완료. 검색 결과에 따른 페이지 이동버튼, 넘버 이동 로직 만들어야함.
         * 해당 script는 template fragment로 사용할 것
         */

        window.onload = () => {
            const list = [[${response.list}]];
            const pagination = [[${response.pagination}]];
            const params = [[${params}]];
            let num = pagination.totalRecordCount - ((params.page - 1) * params.recordSize);
            drawPage(pagination, params);
        }


        function drawPage(pagination, params){
            if(!pagination || !params){
                document.querySelector('.paging').innerHTML = '';
                throw new Error('Missing required paramters...');
            }
            let html ='';

                html =`<ul class="pagination justify-content-center">`;
            if(pagination.existPrevPage){
                html += `
                    <li class="page-item"><a href="javascript::void(0);" onclick="movePage(1)" class="page_bt first">처음</a></li>
                    <li class="page-item"><a href="javascript::void(0);" onclick="movePage(${pagination.startPage - 1})" class="page_bt prev">◀</a></li>
                        `;
            }

            for(let i = pagination.startPage; i<=pagination.endPage; i++){
                html += (i !== params.page)
                    ? `<li class="page-item"><a href="javascript:void(0);" class="page-link" onclick="movePage(${i})">${i}</a></li>`
                    : `<li class="page-item"><span class="on page-link" style="color: gray">${i}</span></li>`;
            }

            // html += '<p>';
            // for(let i = pagination.startPage; i<=pagination.endPage; i++){
            //     html += (i !== params.page)
            //     ? `<a href="javascript:void(0);" onclick="movePage(${i})">${i}</a>`
            //     : `<span class="on">${i}</span>`
            // }
            // html += `</p>`;

            if(pagination.existNextPage){
                html += `
                    <li class="page-item"><a href="javascript:void();" onclick="movePage(${pagination.endPage + 1});" class="page_bt next">▶</a></li>
                    <li class="page-item"><a href="javascript:void();" onclick="movePage(${pagination.totalPageCount});" class="page_bt last">끝</a></li>
                     `;
            }
            html +=`</ul>`;

            document.querySelector('.paging').innerHTML = html;
        }

        function movePage(page){
            const queryParams = {
                page: (page) ? page : 1,
                recordSize: 10,
                pageSize: 10
            }

            location.href = location.pathname + '?' + new URLSearchParams(queryParams).toString();

        }

    </script>
</th:block>
</html>